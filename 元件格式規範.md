# SVG電路元件格式規範

## 1. 基本設計原則

### 1.1 座標系統
- **原點 (0,0)**: 元件的幾何中心
- **單位**: gridSize = 20px
- **方向**: X軸向右為正，Y軸向下為正
- **對稱性**: 盡量保持元件圖形對稱，便於旋轉

### 1.2 尺寸規範
- **標準寬度**: 4 × gridSize (80px)
- **標準高度**: 2 × gridSize (40px) 
- **端子延伸**: 2 × gridSize (40px) 從元件邊緣延伸
- **最大元件尺寸**: 不超過 6 × gridSize × 6 × gridSize

### 1.3 視覺風格
- **線條粗細**: 預設 stroke-width="1", 重要結構可用 "2" 或 "3"
- **顏色**: 預設使用繼承色彩，特殊元素可用 "#00e6e6" (青色)
- **填充**: 一般為 fill="none"，特殊標記可用實心填充

## 2. 端子定義系統

### 2.1 端子命名規範

#### 雙端子元件 (Resistor, Capacitor, Inductor, DC_Source)
```javascript
terminals: {
    t1: { x: x - gridSize * 2, y: y },  // 左端子
    t2: { x: x + gridSize * 2, y: y }   // 右端子
}
```

#### 三端子元件 (MOSFET)
```javascript
terminals: {
    gate: { x: x - gridSize * 2, y: y },       // 閘極 (左側)
    drain: { x: x, y: y - gridSize * 2 },      // 漏極 (上方)
    source: { x: x, y: y + gridSize * 2 }      // 源極 (下方)
}
```

#### 多端子元件 (運算放大器、IC等)
```javascript
terminals: {
    vp: { x: x - gridSize * 2, y: y - gridSize },     // 正輸入
    vn: { x: x - gridSize * 2, y: y + gridSize },     // 負輸入
    out: { x: x + gridSize * 2, y: y },               // 輸出
    vdd: { x: x, y: y - gridSize * 2 },               // 正電源
    vss: { x: x, y: y + gridSize * 2 }                // 負電源
}
```

### 2.2 端子位置計算規則
- 端子必須位於 gridSize 的整數倍位置
- 端子應位於元件外緣，便於連線
- 考慮旋轉時端子位置的變換

## 3. SVG結構規範

### 3.1 基本結構模板
```javascript
ComponentName: `
    <!-- 端子連線 -->
    <line x1="${-gridSize*2}" y1="0" x2="${-gridSize}" y2="0"></line>
    <line x1="${gridSize}" y1="0" x2="${gridSize*2}" y2="0"></line>
    
    <!-- 主體圖形 -->
    <rect x="${-gridSize}" y="${-gridSize/2}" width="${gridSize*2}" height="${gridSize}"></rect>
    
    <!-- 特殊標記 -->
    <text x="0" y="5" text-anchor="middle" font-size="12">R</text>
`
```

### 3.2 必要元素
1. **端子連線**: 從元件主體到端子點的連線
2. **主體圖形**: 元件的主要識別圖形
3. **標記符號**: 元件類型識別符號 (可選)
4. **特殊功能**: 極性、方向性等標記

### 3.3 座標參考點

#### 雙端子元件端子位置
- 左端子: `(-gridSize*2, 0)`
- 右端子: `(gridSize*2, 0)`

#### 三端子元件端子位置 (MOSFET標準)
- 閘極: `(-gridSize*2, 0)`
- 漏極: `(0, -gridSize*2)`
- 源極: `(0, gridSize*2)`

## 4. 元件數據結構

### 4.1 完整元件定義
```javascript
{
    // 基本資訊
    id: "R1",              // 唯一識別符
    type: "Resistor",      // 元件類型
    value: 1000,           // 元件數值
    
    // 位置與方向
    x: 100,                // X座標
    y: 200,                // Y座標
    rotation: 0,           // 旋轉角度 (0, 90, 180, 270)
    
    // 端子定義
    terminals: {
        t1: { x: 60, y: 200 },
        t2: { x: 140, y: 200 }
    }
}
```

### 4.2 SVG定義格式
```javascript
const componentSVGs = {
    ComponentName: `SVG模板字符串`
};
```

## 5. 元件設計工具需求

### 5.1 輸入功能
- **基本圖形**: 線條、矩形、圓形、橢圓、路徑
- **文字標註**: 元件標記文字
- **端子標記**: 可視化端子位置定義
- **尺寸控制**: gridSize 對齊輔助

### 5.2 端子定義功能
- **端子放置**: 點擊放置端子點
- **端子命名**: 為每個端子指定名稱
- **端子屬性**: 輸入/輸出/雙向屬性
- **自動對齊**: 端子自動對齊到 gridSize 網格

### 5.3 導出功能
- **SVG代碼**: 生成符合規範的SVG字符串
- **端子數據**: 生成端子位置定義
- **元件定義**: 生成完整的JavaScript元件定義
- **預覽功能**: 實時預覽元件在電路中的效果

## 6. 常見元件類型

### 6.1 被動元件
- **電阻器**: 矩形主體，兩端子
- **電容器**: 兩條平行線，兩端子  
- **電感器**: 螺旋線圈，兩端子

### 6.2 主動元件
- **MOSFET**: 閘極-漏極-源極三端子，含體二極體
- **BJT**: 基極-集極-發射極三端子
- **二極體**: 三角形-直線結構，兩端子

### 6.3 電源元件
- **直流電源**: 圓形含+/-標記，兩端子
- **交流電源**: 波形符號，兩端子
- **接地**: 三條水平線，單端子

### 6.4 複雜元件
- **運算放大器**: 三角形主體，多端子
- **IC**: 矩形主體，多端子
- **開關**: 可動接點，多端子

## 7. 驗證規則

### 7.1 格式驗證
- SVG語法正確性
- 座標值為gridSize整數倍
- 端子位置在有效範圍內

### 7.2 功能驗證  
- 端子數量與元件類型匹配
- 旋轉後端子位置正確計算
- 與現有系統兼容性

### 7.3 視覺驗證
- 元件圖形清晰可識別
- 端子連接點明確
- 整體比例協調

這個規範將作為元件設計工具的開發指南，確保生成的元件能完美整合到電路模擬器中。