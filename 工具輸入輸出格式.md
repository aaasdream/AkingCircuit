# 元件設計工具輸入輸出格式

## 1. 工具輸入格式

### 1.1 工作區數據格式
```javascript
// 設計工作區狀態
{
  "projectInfo": {
    "name": "新元件",
    "type": "passive",        // passive/active/source/complex
    "category": "resistor",   // 元件分類
    "author": "設計者名稱",
    "description": "元件描述",
    "version": "1.0"
  },
  
  "canvas": {
    "width": 400,
    "height": 300,
    "gridSize": 20,
    "showGrid": true,
    "snapToGrid": true,
    "zoom": 1.0,
    "pan": {"x": 0, "y": 0}
  },
  
  "elements": [
    {
      "id": "line_1",
      "type": "line",
      "x1": -40, "y1": 0, "x2": -20, "y2": 0,
      "stroke": "currentColor",
      "strokeWidth": 1
    },
    {
      "id": "rect_1", 
      "type": "rect",
      "x": -20, "y": -10, "width": 40, "height": 20,
      "fill": "none",
      "stroke": "currentColor", 
      "strokeWidth": 1
    }
  ],
  
  "terminals": [
    {
      "id": "terminal_1",
      "name": "t1",
      "displayName": "1",
      "x": -40, "y": 0,
      "direction": "bidirectional",
      "electricalType": "signal"
    },
    {
      "id": "terminal_2", 
      "name": "t2",
      "displayName": "2", 
      "x": 40, "y": 0,
      "direction": "bidirectional",
      "electricalType": "signal"
    }
  ],
  
  "properties": {
    "defaultValue": 1000,
    "unit": "Ω",
    "valueRange": {"min": 0.1, "max": 1e9},
    "customProperties": {}
  }
}
```

### 1.2 SVG元素類型定義
```javascript
// 支援的SVG元素類型
const supportedElements = {
  "line": {
    "attributes": ["x1", "y1", "x2", "y2", "stroke", "strokeWidth"],
    "defaultStyle": {
      "stroke": "currentColor",
      "strokeWidth": 1
    }
  },
  
  "rect": {
    "attributes": ["x", "y", "width", "height", "fill", "stroke", "strokeWidth"],
    "defaultStyle": {
      "fill": "none", 
      "stroke": "currentColor",
      "strokeWidth": 1
    }
  },
  
  "circle": {
    "attributes": ["cx", "cy", "r", "fill", "stroke", "strokeWidth"],
    "defaultStyle": {
      "fill": "none",
      "stroke": "currentColor", 
      "strokeWidth": 1
    }
  },
  
  "ellipse": {
    "attributes": ["cx", "cy", "rx", "ry", "fill", "stroke", "strokeWidth"]
  },
  
  "polygon": {
    "attributes": ["points", "fill", "stroke", "strokeWidth"],
    "defaultStyle": {
      "fill": "none",
      "stroke": "currentColor",
      "strokeWidth": 1
    }
  },
  
  "path": {
    "attributes": ["d", "fill", "stroke", "strokeWidth"],
    "defaultStyle": {
      "fill": "none",
      "stroke": "currentColor", 
      "strokeWidth": 1
    }
  },
  
  "text": {
    "attributes": ["x", "y", "text-anchor", "font-size", "fill"],
    "defaultStyle": {
      "fill": "currentColor",
      "fontSize": 12,
      "textAnchor": "middle"
    }
  }
};
```

## 2. 工具輸出格式

### 2.1 標準JSON元件定義
按照前面定義的 `component-schema.json` 格式輸出完整的元件定義。

### 2.2 JavaScript代碼輸出
```javascript
// 直接可用於現有電路模擬器的格式
const componentOutput = {
  // 1. SVG定義 (用於components.js)
  svg: `<line x1="-40" y1="0" x2="-20" y2="0"></line><rect x="-20" y="-10" width="40" height="20"></rect><line x1="20" y1="0" x2="40" y2="0"></line>`,
  
  // 2. 端子定義 (用於createComponentData函數)
  terminalConfig: {
    "t1": { "x": "x - gridSize * 2", "y": "y" },
    "t2": { "x": "x + gridSize * 2", "y": "y" }
  },
  
  // 3. 旋轉計算 (用於updateComponentTerminals函數)
  rotationLogic: `
const t1Pos = { x: -gridSize * 2, y: 0 };
const t2Pos = { x: gridSize * 2, y: 0 };
component.terminals.t1.x = component.x + (t1Pos.x * cosA - t1Pos.y * sinA);
component.terminals.t1.y = component.y + (t1Pos.x * sinA + t1Pos.y * cosA);
  `,
  
  // 4. 預設屬性
  defaultProperties: {
    "shortType": "R",
    "defaultValue": 1000,
    "unit": "Ω"
  }
};
```

### 2.3 程式碼生成模板
```javascript
// 自動生成components.js插入代碼
function generateComponentCode(componentData) {
  const componentName = componentData.metadata.category.toUpperCase();
  
  return `
// ${componentData.metadata.name}
${componentName}: \`${componentData.svg.template}\`,

// 在createComponentData函數中添加:
if (type === '${componentName}') {
  componentData.terminals = {
    ${componentData.terminals.map(t => 
      `${t.name}: { x: x + gridSize * ${t.position.x}, y: y + gridSize * ${t.position.y} }`
    ).join(',\n    ')}
  };
}

// 在updateComponentTerminals函數中添加:
if (component.type === '${componentName}') {
  ${componentData.terminals.map(t => `
  const ${t.name}Pos = { x: gridSize * ${t.position.x}, y: gridSize * ${t.position.y} };
  component.terminals.${t.name}.x = component.x + (${t.name}Pos.x * cosA - ${t.name}Pos.y * sinA);
  component.terminals.${t.name}.y = component.y + (${t.name}Pos.x * sinA + ${t.name}Pos.y * cosA);`
  ).join('')}
}
  `;
}
```

## 3. 檔案管理

### 3.1 儲存格式
- **專案檔**: `.acproj` (JSON格式，包含完整設計狀態)
- **元件檔**: `.json` (標準元件定義格式)
- **匯出檔**: `.js` (JavaScript代碼片段)

### 3.2 檔案操作
```javascript
// 儲存專案
function saveProject(projectData) {
  const blob = new Blob([JSON.stringify(projectData, null, 2)], 
    {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${projectData.projectInfo.name}.acproj`;
  a.click();
}

// 匯出元件定義
function exportComponent(componentData) {
  const blob = new Blob([JSON.stringify(componentData, null, 2)], 
    {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${componentData.metadata.category}.json`;
  a.click();
}

// 匯出JavaScript代碼
function exportJavaScript(componentData) {
  const code = generateComponentCode(componentData);
  const blob = new Blob([code], {type: 'text/javascript'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${componentData.metadata.category}.js`;
  a.click();
}
```

## 4. 驗證規則

### 4.1 設計時驗證
- 端子位置必須在網格點上
- 元件圖形不能超出邊界框
- 端子名稱不能重複
- SVG語法正確性檢查

### 4.2 匯出前驗證
- 所有必要端子已定義
- SVG可正確渲染
- 端子位置與圖形匹配
- 元件屬性完整性

### 4.3 相容性檢查
- 與現有系統格式相容
- gridSize一致性
- 座標系統正確性

這個格式規範確保了設計工具能夠產生與電路模擬器完全相容的元件定義。